<?xml version="1.0"?>

<!--

 Copyright 2020-2020 Vrije Universiteit Brussel

 This file is part of cesm-config,
 originally created by the HPC team of Vrije Universiteit Brussel (https://hpc.vub.be),
 with support of Vrije Universiteit Brussel (https://www.vub.be),
 the Flemish Supercomputer Centre (VSC) (https://www.vscentrum.be),
 the Flemish Research Foundation (FWO) (http://www.fwo.be/en)
 and the Department of Economy, Science and Innovation (EWI) (http://www.ewi-vlaanderen.be/en).

 https://github.com/vub-hpc/cesm-config

 cesm-config is free software: you can redistribute it and/or modify
 it under the terms of the GNU Library General Public License as
 published by the Free Software Foundation, either version 3 of
 the License, or (at your option) any later version.

 cesm-config is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 GNU Library General Public License for more details.

 You should have received a copy of the GNU Library General Public License
 along with cesm-config. If not, see <http://www.gnu.org/licenses/>.

Desripion:

Machine configuration file for the following HPC clusters
- VSC Tier-2: Hydra
- VSC Tier-1: Breniac

Author: Alex Domingo (Vrije Universiteit Brussel)
-->

<config_machines>

  <machine MACH="hydra">
    <DESC> Hydra - heterogeneous cluster at VUB, batch system is PBS</DESC>
    <NODENAME_REGEX>(node3.*\.hydra\.(os|brussel\.vsc)|login.*\.cerberus\.os)</NODENAME_REGEX>
    <OS>LINUX</OS>
    <COMPILERS>intel</COMPILERS>
    <MPILIBS>impi</MPILIBS>
    <CIME_OUTPUT_ROOT>$ENV{VSC_SCRATCH}/cesm/output</CIME_OUTPUT_ROOT>
    <DIN_LOC_ROOT>$ENV{VSC_SCRATCH}/cesm/inputdata</DIN_LOC_ROOT>
    <DIN_LOC_ROOT_CLMFORC>$ENV{VSC_SCRATCH}/cesm/inputdata/atm/datm7</DIN_LOC_ROOT_CLMFORC>
    <DOUT_S_ROOT>$CIME_OUTPUT_ROOT/archive/$CASE</DOUT_S_ROOT>
    <BASELINE_ROOT>$ENV{VSC_SCRATCH}/cesm/cesm_baselines</BASELINE_ROOT>
    <CCSM_CPRNC>$ENV{VSC_SCRATCH}/cesm/tools/cprnc/cprnc</CCSM_CPRNC>
    <GMAKE_J>4</GMAKE_J>
    <BATCH_SYSTEM>slurm</BATCH_SYSTEM>
    <SUPPORTED_BY>VUB-HPC</SUPPORTED_BY>
    <MAX_TASKS_PER_NODE>40</MAX_TASKS_PER_NODE>
    <MAX_MPITASKS_PER_NODE>40</MAX_MPITASKS_PER_NODE>
    <PROJECT_REQUIRED>FALSE</PROJECT_REQUIRED>
    <mpirun mpilib="impi">
      <executable>srun</executable>
      <arguments>
        <arg name="num_tasks">--ntasks={{ total_tasks }}</arg>
        <arg name="cpu_bind">--cpu_bind=sockets --cpu_bind=verbose</arg>
        <arg name="kill-on-bad-exit">--kill-on-bad-exit</arg>
      </arguments>
    </mpirun>
    <module_system type="module">
      <init_path lang="perl">/usr/share/lmod/lmod/init/perl</init_path>
      <init_path lang="python">/usr/share/lmod/lmod/init/env_modules_python.py</init_path>
      <init_path lang="csh">/usr/share/lmod/lmod/init/csh</init_path>
      <init_path lang="sh">/usr/share/lmod/lmod/init/sh</init_path>
      <cmd_path lang="perl">/usr/share/lmod/lmod/libexec/lmod perl -q</cmd_path>
      <cmd_path lang="python">/usr/share/lmod/lmod/libexec/lmod python -q</cmd_path>
      <cmd_path lang="sh">module -q</cmd_path>
      <cmd_path lang="csh">module -q</cmd_path>
      <modules>
        <command name="purge"/>
      </modules>
      <modules compiler="intel">
        <command name="load">CESM-deps/2-intel-2019b</command>
      </modules>
    </module_system>
    <resource_limits>
      <resource name="RLIMIT_STACK">-1</resource>
    </resource_limits>
  </machine>

  <machine MACH="breniac">
    <DESC> BrENIAC - Tier-1 cluster of VSC, batch system is PBS</DESC>
    <NODENAME_REGEX>(r0[0-9]i[0-9]+n[12]|login1)</NODENAME_REGEX>
    <OS>LINUX</OS>
    <COMPILERS>intel</COMPILERS>
    <MPILIBS>impi</MPILIBS>
    <CIME_OUTPUT_ROOT>$ENV{VSC_SCRATCH}/cesm/output</CIME_OUTPUT_ROOT>
    <DIN_LOC_ROOT>$ENV{VSC_SCRATCH}/cesm/inputdata</DIN_LOC_ROOT>
    <DIN_LOC_ROOT_CLMFORC>$ENV{VSC_SCRATCH}/cesm/inputdata/atm/datm7</DIN_LOC_ROOT_CLMFORC>
    <DOUT_S_ROOT>$CIME_OUTPUT_ROOT/archive/$CASE</DOUT_S_ROOT>
    <BASELINE_ROOT>$ENV{VSC_SCRATCH}/cesm/cesm_baselines</BASELINE_ROOT>
    <CCSM_CPRNC>$ENV{VSC_SCRATCH}/cesm/tools/cprnc/cprnc</CCSM_CPRNC>
    <GMAKE_J>4</GMAKE_J>
    <BATCH_SYSTEM>pbs</BATCH_SYSTEM>
    <SUPPORTED_BY>KU Leuven</SUPPORTED_BY>
    <MAX_TASKS_PER_NODE>24</MAX_TASKS_PER_NODE>
    <MAX_MPITASKS_PER_NODE>24</MAX_MPITASKS_PER_NODE>
    <PROJECT_REQUIRED>TRUE</PROJECT_REQUIRED>
    <mpirun mpilib="impi">
      <executable>mpirun</executable>
    </mpirun>
    <module_system type="module">
      <init_path lang="perl">/usr/share/Modules/init/perl.pm</init_path>
      <init_path lang="python">/usr/share/Modules/init/python.py</init_path>
      <init_path lang="csh">/usr/share/Modules/init/csh</init_path>
      <init_path lang="sh">/usr/share/Modules/init/sh</init_path>
      <cmd_path lang="perl">/usr/bin/modulecmd perl</cmd_path>
      <cmd_path lang="python">/usr/bin/modulecmd python</cmd_path>
      <cmd_path lang="sh">module</cmd_path>
      <cmd_path lang="csh">module</cmd_path>
      <modules>
        <command name="purge"/>
        <command name="load">XML-LibXML/2.0201-GCCcore-8.3.0</command>
        <command name="load">Python/2.7.16-GCCcore-8.3.0</command>
        <command name="load">CMake/3.15.3-GCCcore-8.3.0</command>
        <command name="load">git/2.30.1-GCCcore-8.3.0</command>
      </modules>
      <modules compiler="intel">
        <command name="load">CESM-deps/2-intel-2019b</command>
      </modules>
    </module_system>
  </machine>

  <machine MACH="breniac-skl">
    <DESC> BrENIAC - Tier-1 cluster of VSC, batch system is PBS</DESC>
    <NODENAME_REGEX>r1[0-9]i[0-9]+n[12]</NODENAME_REGEX>
    <OS>LINUX</OS>
    <COMPILERS>intel</COMPILERS>
    <MPILIBS>impi</MPILIBS>
    <CIME_OUTPUT_ROOT>$ENV{VSC_SCRATCH}/cesm/output</CIME_OUTPUT_ROOT>
    <DIN_LOC_ROOT>$ENV{VSC_SCRATCH}/cesm/inputdata</DIN_LOC_ROOT>
    <DIN_LOC_ROOT_CLMFORC>$ENV{VSC_SCRATCH}/cesm/inputdata/atm/datm7</DIN_LOC_ROOT_CLMFORC>
    <DOUT_S_ROOT>$CIME_OUTPUT_ROOT/archive/$CASE</DOUT_S_ROOT>
    <BASELINE_ROOT>$ENV{VSC_SCRATCH}/cesm/cesm_baselines</BASELINE_ROOT>
    <CCSM_CPRNC>$ENV{VSC_SCRATCH}/cesm/tools/cprnc/cprnc</CCSM_CPRNC>
    <GMAKE_J>4</GMAKE_J>
    <BATCH_SYSTEM>pbs</BATCH_SYSTEM>
    <SUPPORTED_BY>KU Leuven</SUPPORTED_BY>
    <MAX_TASKS_PER_NODE>24</MAX_TASKS_PER_NODE>
    <MAX_MPITASKS_PER_NODE>24</MAX_MPITASKS_PER_NODE>
    <PROJECT_REQUIRED>TRUE</PROJECT_REQUIRED>
    <mpirun mpilib="impi">
      <executable>mpirun</executable>
    </mpirun>
    <module_system type="module">
      <init_path lang="perl">/usr/share/Modules/init/perl.pm</init_path>
      <init_path lang="python">/usr/share/Modules/init/python.py</init_path>
      <init_path lang="csh">/usr/share/Modules/init/csh</init_path>
      <init_path lang="sh">/usr/share/Modules/init/sh</init_path>
      <cmd_path lang="perl">/usr/bin/modulecmd perl</cmd_path>
      <cmd_path lang="python">/usr/bin/modulecmd python</cmd_path>
      <cmd_path lang="sh">module</cmd_path>
      <cmd_path lang="csh">module</cmd_path>
      <modules>
        <command name="purge"/>
        <command name="load">XML-LibXML/2.0201-GCCcore-8.3.0</command>
        <command name="load">Python/2.7.16-GCCcore-8.3.0</command>
        <command name="load">CMake/3.15.3-GCCcore-8.3.0</command>
        <command name="load">git/2.30.1-GCCcore-8.3.0</command>
      </modules>
      <modules compiler="intel">
        <command name="load">CESM-deps/2-intel-2019b</command>
      </modules>
    </module_system>
  </machine>

</config_machines>
